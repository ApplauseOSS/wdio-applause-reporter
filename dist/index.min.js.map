{"version":3,"file":"index.min.js","sources":["../src/index.ts"],"sourcesContent":["import WDIOReporter, { TestStats } from '@wdio/reporter';\nimport {\n  ApplauseReporter,\n  ApplauseConfig,\n  TestResultStatus,\n  loadConfig,\n  parseTestCaseName,\n  PublicApi,\n  TestRunAutoResultStatus,\n} from 'applause-reporter-common';\nimport { Browser } from 'webdriverio';\n\ndeclare let browser: Browser;\n\nexport class ApplauseWdioReporter extends WDIOReporter {\n  private reporter: ApplauseReporter;\n\n  constructor(options: Partial<ApplauseConfig>) {\n    super({ stdout: true, ...options });\n    const config = loadConfig({\n      properties: options,\n    });\n    // Setup the initial maps\n    this.reporter = new ApplauseReporter(config);\n  }\n\n  onRunnerStart() {\n    this.reporter.runnerStart();\n  }\n\n  onTestStart(testStats: TestStats): void {\n    this.reporter.startTestCase(testStats.uid, testStats.fullTitle, {\n      providerSessionIds: [browser.sessionId],\n    });\n  }\n\n  onTestPass(test: TestStats): void {\n    this.reporter.submitTestCaseResult(test.uid, TestResultStatus.PASSED, {\n      providerSessionGuids: [browser.sessionId],\n    });\n  }\n\n  onTestFail(test: TestStats): void {\n    this.reporter.submitTestCaseResult(test.uid, TestResultStatus.FAILED, {\n      failureReason: test.error?.message,\n      providerSessionGuids: [browser.sessionId],\n    });\n  }\n\n  onTestRetry(test: TestStats): void {\n    this.reporter.submitTestCaseResult(test.uid, TestResultStatus.SKIPPED, {\n      failureReason: test.error?.message,\n      providerSessionGuids: [browser.sessionId],\n    });\n  }\n\n  onTestSkip(test: TestStats): void {\n    this.reporter.submitTestCaseResult(test.uid, TestResultStatus.SKIPPED, {\n      failureReason: test.error?.message,\n      providerSessionGuids: [browser.sessionId],\n    });\n  }\n\n  async onRunnerEnd(): Promise<void> {\n    await this.reporter.runnerEnd();\n  }\n\n  get isSynchronised(): boolean {\n    return this.reporter.isSynchronized();\n  }\n}\n\nexport class ApplausePlatformWdioReporter extends WDIOReporter {\n  private publciApi: PublicApi;\n  private config: ApplauseConfig;\n  private inflightCalls: Promise<any>[] = [];\n\n  constructor(options: Partial<ApplauseConfig>) {\n    super({ stdout: true, ...options });\n    this.config = loadConfig({\n      properties: options,\n    });\n    // Setup the initial maps\n    this.publciApi = new PublicApi(this.config);\n  }\n\n  onTestPass(test: TestStats): void {\n    const applauseTestCaseId = parseTestCaseName(\n      test.fullTitle\n    ).applauseTestCaseId;\n    if (applauseTestCaseId !== undefined) {\n      const caps = browser.capabilities as WebdriverIO.Capabilities;\n      this.inflightCalls.push(\n        this.publciApi.submitResult(Number(applauseTestCaseId), {\n          testCycleId: this.config.applauseTestCycleId!,\n          status: TestRunAutoResultStatus.PASSED,\n          sessionDetailsJson: {\n            value: {\n              deviceName: caps['appium:deviceName'],\n              orientation: caps['appium:orientation'],\n              platformName: caps.platformName,\n              platformVersion: caps['appium:platformVersion'],\n              browserName: caps.browserName,\n              browserVersion: caps.browserVersion,\n            },\n          },\n        })\n      );\n    }\n  }\n\n  onTestFail(test: TestStats): void {\n    const applauseTestCaseId = parseTestCaseName(\n      test.fullTitle\n    ).applauseTestCaseId;\n    if (applauseTestCaseId !== undefined) {\n      this.inflightCalls.push(\n        this.publciApi.submitResult(Number(applauseTestCaseId), {\n          testCycleId: this.config.applauseTestCycleId!,\n          status: TestRunAutoResultStatus.PASSED,\n        })\n      );\n    }\n  }\n\n  onTestSkip(test: TestStats): void {\n    const applauseTestCaseId = parseTestCaseName(\n      test.fullTitle\n    ).applauseTestCaseId;\n    if (applauseTestCaseId !== undefined) {\n      this.inflightCalls.push(\n        this.publciApi.submitResult(Number(applauseTestCaseId), {\n          testCycleId: this.config.applauseTestCycleId!,\n          status: TestRunAutoResultStatus.PASSED,\n        })\n      );\n    }\n  }\n\n  async onRunnerEnd(): Promise<void> {\n    void (await Promise.all(this.inflightCalls));\n  }\n\n  get isSynchronised(): boolean {\n    return this.publciApi.getCallsInFlight === 0;\n  }\n}\n\nexport { ApplauseConfig };\n"],"names":["WDIOReporter","publciApi","config","inflightCalls","constructor","options","super","stdout","this","loadConfig","properties","PublicApi","onTestPass","test","applauseTestCaseId","parseTestCaseName","fullTitle","undefined","caps","browser","capabilities","push","submitResult","Number","testCycleId","applauseTestCycleId","status","TestRunAutoResultStatus","PASSED","sessionDetailsJson","value","deviceName","orientation","platformName","platformVersion","browserName","browserVersion","onTestFail","onTestSkip","onRunnerEnd","Promise","all","isSynchronised","getCallsInFlight","reporter","ApplauseReporter","onRunnerStart","runnerStart","onTestStart","testStats","startTestCase","uid","providerSessionIds","sessionId","submitTestCaseResult","TestResultStatus","providerSessionGuids","FAILED","failureReason","error","message","onTestRetry","SKIPPED","runnerEnd","isSynchronized"],"mappings":"sbAwEM,cAA4CA,EACxCC,UACAC,OACAC,cAAgC,GAExC,WAAAC,CAAYC,GACVC,MAAM,CAAEC,QAAQ,KAASF,IACzBG,KAAKN,OAASO,aAAW,CACvBC,WAAYL,IAGdG,KAAKP,UAAY,IAAIU,EAASA,UAACH,KAAKN,OACrC,CAED,UAAAU,CAAWC,GACT,MAAMC,EAAqBC,EAAiBA,kBAC1CF,EAAKG,WACLF,mBACF,QAA2BG,IAAvBH,EAAkC,CACpC,MAAMI,EAAOC,QAAQC,aACrBZ,KAAKL,cAAckB,KACjBb,KAAKP,UAAUqB,aAAaC,OAAOT,GAAqB,CACtDU,YAAahB,KAAKN,OAAOuB,oBACzBC,OAAQC,EAAuBA,wBAACC,OAChCC,mBAAoB,CAClBC,MAAO,CACLC,WAAYb,EAAK,qBACjBc,YAAad,EAAK,sBAClBe,aAAcf,EAAKe,aACnBC,gBAAiBhB,EAAK,0BACtBiB,YAAajB,EAAKiB,YAClBC,eAAgBlB,EAAKkB,mBAK9B,CACF,CAED,UAAAC,CAAWxB,GACT,MAAMC,EAAqBC,EAAiBA,kBAC1CF,EAAKG,WACLF,wBACyBG,IAAvBH,GACFN,KAAKL,cAAckB,KACjBb,KAAKP,UAAUqB,aAAaC,OAAOT,GAAqB,CACtDU,YAAahB,KAAKN,OAAOuB,oBACzBC,OAAQC,EAAuBA,wBAACC,SAIvC,CAED,UAAAU,CAAWzB,GACT,MAAMC,EAAqBC,EAAiBA,kBAC1CF,EAAKG,WACLF,wBACyBG,IAAvBH,GACFN,KAAKL,cAAckB,KACjBb,KAAKP,UAAUqB,aAAaC,OAAOT,GAAqB,CACtDU,YAAahB,KAAKN,OAAOuB,oBACzBC,OAAQC,EAAuBA,wBAACC,SAIvC,CAED,iBAAMW,SACQC,QAAQC,IAAIjC,KAAKL,cAC9B,CAED,kBAAIuC,GACF,OAA2C,IAApClC,KAAKP,UAAU0C,gBACvB,0BAnIG,cAAoC3C,EAChC4C,SAER,WAAAxC,CAAYC,GACVC,MAAM,CAAEC,QAAQ,KAASF,IACzB,MAAMH,EAASO,EAAAA,WAAW,CACxBC,WAAYL,IAGdG,KAAKoC,SAAW,IAAIC,EAAgBA,iBAAC3C,EACtC,CAED,aAAA4C,GACEtC,KAAKoC,SAASG,aACf,CAED,WAAAC,CAAYC,GACVzC,KAAKoC,SAASM,cAAcD,EAAUE,IAAKF,EAAUjC,UAAW,CAC9DoC,mBAAoB,CAACjC,QAAQkC,YAEhC,CAED,UAAAzC,CAAWC,GACTL,KAAKoC,SAASU,qBAAqBzC,EAAKsC,IAAKI,EAAgBA,iBAAC3B,OAAQ,CACpE4B,qBAAsB,CAACrC,QAAQkC,YAElC,CAED,UAAAhB,CAAWxB,GACTL,KAAKoC,SAASU,qBAAqBzC,EAAKsC,IAAKI,EAAgBA,iBAACE,OAAQ,CACpEC,cAAe7C,EAAK8C,OAAOC,QAC3BJ,qBAAsB,CAACrC,QAAQkC,YAElC,CAED,WAAAQ,CAAYhD,GACVL,KAAKoC,SAASU,qBAAqBzC,EAAKsC,IAAKI,EAAgBA,iBAACO,QAAS,CACrEJ,cAAe7C,EAAK8C,OAAOC,QAC3BJ,qBAAsB,CAACrC,QAAQkC,YAElC,CAED,UAAAf,CAAWzB,GACTL,KAAKoC,SAASU,qBAAqBzC,EAAKsC,IAAKI,EAAgBA,iBAACO,QAAS,CACrEJ,cAAe7C,EAAK8C,OAAOC,QAC3BJ,qBAAsB,CAACrC,QAAQkC,YAElC,CAED,iBAAMd,SACE/B,KAAKoC,SAASmB,WACrB,CAED,kBAAIrB,GACF,OAAOlC,KAAKoC,SAASoB,gBACtB"}